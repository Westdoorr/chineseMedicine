webpackJsonp([18],{"3ilh":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("mvHQ"),r=i.n(o),a={name:"xjczbr",data:function(){return{canvas:"",saveImage:"",mediaStreamTrack:null,dialogphotoVisible:!1,disappear:!0,form:{picture:"",country:"",sourceProvince:null,sourceCity:null,age:null,pname:null,birthday:null,gender:"男"},placeDate:{},country:[],province:[],city:[],rules:{pname:[{required:!0,message:"请输入姓名"}]},value1:"2018-07-01"}},created:function(){document.title="首页",this.setProList("0"),this.setCityList("24"),this.form.country="0",this.form.sourceProvince=24,this.form.sourceCity=1348},beforeMount:function(){this.getPlace()},computed:{birthday:function(){return this.form.birthday}},watch:{birthday:function(t,e){var i=this.$common.GetAgeByBrithday(t);this.form.age=i},placeDate:function(t,e){this.setProList("0"),this.setCityList("24"),this.form.country="0",this.form.sourceProvince=24,this.form.sourceCity=1348}},methods:{getMedia:function(){var t=this;t.form.picture=[];navigator.mediaDevices.getUserMedia({video:{width:280,height:400}}).then(function(e){t.mediaStreamTrack=e.getTracks()[0],t.$refs.video.src=URL.createObjectURL(e),t.$refs.video.play()}),t.dialogphotoVisible=!0},funclose:function(){this.mediaStreamTrack.stop()},takePhoto:function(){var t=document.getElementById("video");this.canvas=document.getElementById("canvas"),this.canvas.getContext("2d").drawImage(t,0,0,280,400)},confirmphoto:function(){var t=this.canvas.toDataURL("image/png");this.form.picture=t,this.dialogphotoVisible=!1,this.mediaStreamTrack.stop()},opencomfigMethod:function(t,e,i){this.$common.openComfigDialog(t,e,i,this)},setCityList:function(t){var e=this.$store.getters.gettersPlaceData.placeList;for(var i in this.form.sourceCity=null,this.city=[],e)if(e[i].id==t){this.city=e[i].cityList;break}},setProList:function(t){if(console.log(t),this.province=[],this.city=[],this.form.sourceProvince=null,this.form.sourceCity=null,"0"==t){e=(e=this.$store.getters.gettersPlaceData.placeList).slice(1,35),this.province=e}else{var e=this.$store.getters.gettersPlaceData.placeList;this.province=e.slice(35)}},updateWgzdm:function(t){var e=new Array;for(var i in t){var o=new Object;o.id=t[i].cityId,o.provName=t[i].cityName,o.cityList=[],e.push(o)}return e},getPlace:function(){var t=this.$store.getters.gettersPlaceData;if(t&&"{}"==r()(t)){var e=this;this.$http.get("/index/getPlace").then(function(i){console.log("地址",i),"1"==i.code?(t=i.data,e.$store.dispatch("changePlaceData",t),e.placeDate=e.$store.getters.gettersPlaceData):e.$common.openErrorMsgBox(i.msg,e)}).catch(function(t){e.$common.openErrorMsgBox(t,e)})}},putinname:function(){var t=this.form.pname.replace(/\s*/g,"");this.form.pname=t,this.form.pname.match(/^[ ]*$/)?this.$common.openErrorMsgBox("请填写姓名",this):console.log("正确")},changeBirdate:function(){if(this.form.birthday){var t=new RegExp(/^([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8])))$/),e=new RegExp(/^([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})(((0[13578]|1[02])(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)(0[1-9]|[12][0-9]|30))|(02(0[1-9]|[1][0-9]|2[0-8])))$/);t.test(this.form.birthday)&&this.form.birthday.length>7?this.isBirthday()&&this.isDayRight()||this.$common.openErrorMsgBox("请输入正确的日期格式",this):e.test(this.form.birthday)&&this.form.birthday.length>7?this.form.birthday=this.form.birthday.substring(0,4)+"-"+this.form.birthday.substring(4,6)+"-"+this.form.birthday.substring(6,8):this.$common.openErrorMsgBox("请输入正确的日期格式",this)}},isBirthday:function(){var t=new Date,e={};e.M=t.getMonth()+1,e.Y=t.getFullYear(),e.D=t.getDate();var i=parseInt(this.form.birthday.substring(0,4).replace(/\b(0+)/gi,"")),o=parseInt(this.form.birthday.substring(5,7).replace(/\b(0+)/gi,"")),r=parseInt(this.form.birthday.substring(8,10).replace(/\b(0+)/gi,"")),a=i<e.Y,n=i===e.Y,s=o<e.M,c=o===e.M,l=r<=e.D;return!!a||(!(a||!n||!s)||!(a||!n||s||!c||!l))},isDayRight:function(){parseInt(this.form.birthday.substring(0,4).replace(/\b(0+)/gi,""));var t=parseInt(this.form.birthday.substring(5,7).replace(/\b(0+)/gi,"")),e=parseInt(this.form.birthday.substring(8,10).replace(/\b(0+)/gi,""));return(1!==t&&3!==t&&5!==t&&7!==t&&8!==t&&10!==t&&12!==t||!(e>31))&&((4!==t&&6!==t&&9!==t&&11!==t||!(e>30))&&!(2===t&&e>29))},allRequired:function(t){console.log(t);var e=!0;for(var i in t){if(!this.isBirthday()||!this.isDayRight()){e=!1;break}if("age"!==i&&(null===t[i]||""==t[i])){if("sourceCity"==i&&"1"==t.country)continue;e=!1;break}}return e},newInquiry:function(t){var e=this,i=this.$common.openLoading("新建问诊中",e),o={patientId:t};this.$http.post("/inquiry/newInquiry",o).then(function(o){if(i.close(),"1"==o.code){e.$common.openSuccessMsgBox("初诊成功，请开处方",e);var a={pId:t,inquiryId:o.data.inquiryId},n=new Object;n.path="bryfpage",n.data=a,e.$store.dispatch("setPathParams",r()(n));var s=new Object;s.path="xjczbr",s.data={},s.type="new",e.$store.dispatch("setPrePathParams",r()(s)),e.$common.GotoPage("bryfpage",a,e)}else e.$common.openErrorMsgBox(o.msg,e)}).catch(function(t){console.log(t),setTimeout(function(){i.close(),e.$common.openErrorMsgBox(t,e)},1e3)})},newInquiry_new:function(t){var e=this,i={patientId:t};this.$http.post("/inquiry/newInquiry?patientId="+t,i).then(function(i){if("1"==i.code){var o={pId:t,inquiryId:i.data.inquiryId};e.getLastInquiry(o)}else e.$common.openErrorMsgBox(i.msg,e)}).catch(function(t){console.log(t),setTimeout(function(){e.$common.openErrorMsgBox(t,e)},1e3)})},getLastInquiry:function(t){var e="/inquiry/getLatestInquiryInfo?patientId="+t.pId,i=this;this.$http.get(e).then(function(e){if("1"==e.code){if("{}"!=r()(e.data)){e.data.inquiryInfo.inquiryId?t.lastinquiryId=e.data.inquiryInfo.inquiryId:t.lastinquiryId="";var o=new Object;o.path="bryfpage",o.data=t,i.$store.dispatch("setPathParams",r()(o));var a=new Object;a.path="xjczbr",a.data={},i.$store.dispatch("setPrePathParams",r()(a)),i.$common.GotoPage("bryfpage",t,i)}}else i.$common.openErrorMsgBox(e.msg,i)}).catch(function(t){setTimeout(function(){i.$common.openErrorMsgBox(t,i)},1e3)})},czSubmit:function(){var t=this,e=this.allRequired(this.form);if(console.log(this.form),this.form.age<0)this.$message({showClose:!0,message:"年龄不能小于0",type:"error"});else{if(!e)return void this.$common.openErrorMsgBox("请完整填写基本信息!",t);var i=this.$common.openLoading("初诊中",t),o=this.form,r=new FormData;o.picture=t.$common.base64Tofile(o.picture,"111.jpg"),console.log("1111"+o.picture),r.append("picture",o.picture,"111.png"),r.append("country",o.country),r.append("sourceProvince",o.sourceProvince),r.append("sourceCity",o.sourceCity),r.append("age",o.age),r.append("pname",o.pname),r.append("birthday",o.birthday),r.append("gender",o.gender);this.$http.post("/index/firstDiag",r,{post_type:"form-data"}).then(function(e){i.close(),"1"==e.code?t.newInquiry(e.data.pId):t.$common.openErrorMsgBox(e.msg,t)}).catch(function(e){setTimeout(function(){i.close(),t.$common.openErrorMsgBox(e,t)},1e3)})}},isRepeat:function(t){var e=this,i=this.$common.openLoading("复诊诊中",e),o=t;this.$http.post("/index/revisit",o).then(function(o){if(console.log("复诊",o),"1"==o.code)if(0==o.data.isRepeat)e.newInquiry_new(o.data.pId),i.close();else if(1==o.data.isRepeat){i.close();var a={pname:t.pname},n=new Object;n.path="brglpage",n.data=a,console.log(),e.$store.dispatch("setPathParams",r()(n));var s=new Object;s.path="xjczbr",s.data={},e.$store.dispatch("setPrePathParams",r()(s)),e.$common.GotoPage("brglpage",a,e)}else 2==o.data.isRepeat&&(i.close(),e.$common.openErrorMsgBox("该病人需进行初诊",e));else e.$common.openErrorMsgBox(o.msg,e)}).catch(function(t){setTimeout(function(){i.close(),e.$common.openErrorMsgBox(t,e)},1e3)})},fzSubmit:function(){this.form.pname?""!=this.form.pname.replace(/(^\s*)|(\s*$)/g,"")?this.isRepeat(this.form):this.$common.openErrorMsgBox("请填写患者姓名！",this):this.$common.openErrorMsgBox("请填写患者姓名！",this)}}},n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"from-container-div"},[i("div",{staticClass:"base-form-c"},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"156px","label-position":"right"}},[i("el-form-item",{attrs:{label:"姓名",prop:"pname"}},[i("el-input",{staticClass:"index-input",attrs:{placeholder:"请输入姓名"},on:{blur:t.putinname},model:{value:t.form.pname,callback:function(e){t.$set(t.form,"pname",e)},expression:"form.pname"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"性别"}},[i("el-radio-group",{model:{value:t.form.gender,callback:function(e){t.$set(t.form,"gender",e)},expression:"form.gender"}},[i("el-radio",{attrs:{label:"男",value:"男"}}),t._v(" "),i("el-radio",{attrs:{label:"女",value:"女"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"年龄"}},[i("el-row",[i("el-col",{attrs:{span:6}},[i("el-input",{staticClass:"full-width",attrs:{placeholder:"请输入"},model:{value:t.form.age,callback:function(e){t.$set(t.form,"age",e)},expression:"form.age"}})],1),t._v(" "),i("el-col",{attrs:{span:18}},[i("label",{staticClass:"el-form-item__label",staticStyle:{width:"124px","padding-left":"20px","padding-right":"20px"}},[t._v("生日")]),t._v(" "),i("el-input",{staticClass:"index-input",staticStyle:{width:"calc(100% - 124px)"},attrs:{placeholder:"yyyy-mm-dd"},on:{blur:t.changeBirdate},model:{value:t.form.birthday,callback:function(e){t.$set(t.form,"birthday",e)},expression:"form.birthday"}})],1)],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"来源地"}},[i("el-row",{staticClass:"lyd"},[i("el-col",{attrs:{span:8}},[i("el-select",{staticStyle:{"margin-right":"10px"},on:{change:t.setProList},model:{value:t.form.country,callback:function(e){t.$set(t.form,"country",e)},expression:"form.country"}},[i("el-option",{attrs:{label:"中国",value:"0"}}),t._v(" "),i("el-option",{attrs:{label:"外国",value:"1"}})],1)],1),t._v(" "),i("el-col",{attrs:{span:8}},[i("el-select",{staticStyle:{"margin-right":"10px","margin-left":"10px"},attrs:{filterable:"","popper-class":"city"},on:{change:t.setCityList},model:{value:t.form.sourceProvince,callback:function(e){t.$set(t.form,"sourceProvince",e)},expression:"form.sourceProvince"}},t._l(t.province,function(t){return i("el-option",{key:t.id,attrs:{label:t.provName,value:t.id}})}))],1),t._v(" "),i("el-col",{attrs:{span:8}},[i("el-select",{staticStyle:{"margin-left":"10px",width:"185px"},attrs:{filterable:"","popper-class":"city"},model:{value:t.form.sourceCity,callback:function(e){t.$set(t.form,"sourceCity",e)},expression:"form.sourceCity"}},t._l(t.city,function(t){return i("el-option",{key:t.cityId,attrs:{label:t.cityName,value:t.cityId}})}))],1)],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"头像"}},[i("div",[i("i",{staticClass:"el-icon-plus"}),t._v(" "),i("input",{attrs:{type:"button",title:"开启摄像头",value:"开启摄像头"},on:{click:function(e){t.getMedia()}}}),t._v(" "),i("img",{attrs:{src:t.form.picture},on:{click:function(e){t.getMedia()}}}),t._v(" "),i("el-dialog",{attrs:{visible:t.dialogphotoVisible},on:{"update:visible":function(e){t.dialogphotoVisible=e},close:function(e){t.funclose()}}},[i("div",[i("video",{ref:"video",attrs:{id:"video",width:"280px",height:"400px",preload:"auto"}}),t._v(" "),i("canvas",{attrs:{id:"canvas",width:"280px",height:"400px"}}),t._v(" "),i("button",{attrs:{id:"snap"},on:{click:function(e){t.takePhoto()}}},[t._v("拍照")]),t._v(" "),i("button",{on:{click:function(e){t.confirmphoto()}}},[t._v("确定")])])])],1)]),t._v(" "),i("div",{staticClass:"el-form-item"},[i("div",{staticClass:"el-form-item__content",staticStyle:{height:"70px","text-align":"center","line-height":"70px"}},[i("button",{staticClass:"el-button el-button--primary normal-btn-primary",attrs:{type:"button"},on:{click:function(e){t.opencomfigMethod("请问是否进行初访?",t.czSubmit)}}},[i("span",[t._v("初诊")])]),t._v(" "),i("button",{staticClass:"el-button el-button--default normal-btn-default",attrs:{type:"button"},on:{click:function(e){t.opencomfigMethod("请问是否进行复访?",t.fzSubmit)}}},[i("span",[t._v("复诊")])])])])],1)],1)])},staticRenderFns:[]};var s=i("VU/8")(a,n,!1,function(t){i("92nx")},null,null);e.default=s.exports},"92nx":function(t,e){}});
//# sourceMappingURL=18.f51a344b4c4e39a610ac.js.map