webpackJsonp([10],{"3ilh":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("mvHQ"),r=o.n(i),s={name:"xjczbr",data:function(){return{form:{country:"",sourceProvince:null,sourceCity:null,age:null,pname:null,birthday:null,gender:"男"},placeDate:{},country:[],province:[],city:[],rules:{pname:[{required:!0,message:"请输入姓名"}]},value1:"2018-07-01"}},created:function(){document.title="首页",this.setProList("0"),this.setCityList("24"),this.form.country="0",this.form.sourceProvince=24,this.form.sourceCity=1348},beforeMount:function(){this.getPlace()},computed:{birthday:function(){return this.form.birthday}},watch:{birthday:function(t,e){var o=this.$common.GetAgeByBrithday(t);this.form.age=o},placeDate:function(t,e){this.setProList("0"),this.setCityList("24"),this.form.country="0",this.form.sourceProvince=24,this.form.sourceCity=1348}},methods:{opencomfigMethod:function(t,e,o){this.$common.openComfigDialog(t,e,o,this)},setCityList:function(t){var e=this.$store.getters.gettersPlaceData.placeList;for(var o in this.form.sourceCity=null,this.city=[],e)if(e[o].id==t){this.city=e[o].cityList;break}},setProList:function(t){if(console.log(t),this.province=[],this.city=[],this.form.sourceProvince=null,this.form.sourceCity=null,"0"==t){e=(e=this.$store.getters.gettersPlaceData.placeList).slice(1,e.length),this.province=e}else{var e=this.$store.getters.gettersPlaceData.placeList;this.province=e[0].cityList}},updateWgzdm:function(t){var e=new Array;for(var o in t){var i=new Object;i.id=t[o].cityId,i.provName=t[o].cityName,i.cityList=[],e.push(i)}return e},getPlace:function(){var t=this.$store.getters.gettersPlaceData;if(t&&"{}"==r()(t)){var e=this;this.$http.get("/index/getPlace").then(function(o){console.log("地址",o),"1"==o.code?((t=o.data).placeList[0].cityList=e.updateWgzdm(t.placeList[0].cityList),e.$store.dispatch("changePlaceData",t),e.placeDate=e.$store.getters.gettersPlaceData):e.$common.openErrorMsgBox(o.msg,e)}).catch(function(t){e.$common.openErrorMsgBox(t,e)})}},putinname:function(){var t=this.form.pname.replace(/\s*/g,"");this.form.pname=t,this.form.pname.match(/^[ ]*$/)?this.$common.openErrorMsgBox("请填写姓名",this):console.log("正确")},changeBirdate:function(){if(this.form.birthday){var t=new RegExp(/^([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8])))$/),e=new RegExp(/^([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})(((0[13578]|1[02])(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)(0[1-9]|[12][0-9]|30))|(02(0[1-9]|[1][0-9]|2[0-8])))$/);t.test(this.form.birthday)&&this.form.birthday.length>7?this.isBirthday()&&this.isDayRight()||this.$common.openErrorMsgBox("请输入正确的日期格式",this):e.test(this.form.birthday)&&this.form.birthday.length>7?this.form.birthday=this.form.birthday.substring(0,4)+"-"+this.form.birthday.substring(4,6)+"-"+this.form.birthday.substring(6,8):this.$common.openErrorMsgBox("请输入正确的日期格式",this)}},isBirthday:function(){var t=new Date,e={};e.M=t.getMonth()+1,e.Y=t.getFullYear(),e.D=t.getDate();var o=parseInt(this.form.birthday.substring(0,4).replace(/\b(0+)/gi,"")),i=parseInt(this.form.birthday.substring(5,7).replace(/\b(0+)/gi,"")),r=parseInt(this.form.birthday.substring(8,10).replace(/\b(0+)/gi,"")),s=o<e.Y,n=o===e.Y,a=i<e.M,c=i===e.M,l=r<=e.D;return!!s||(!(s||!n||!a)||!(s||!n||a||!c||!l))},isDayRight:function(){parseInt(this.form.birthday.substring(0,4).replace(/\b(0+)/gi,""));var t=parseInt(this.form.birthday.substring(5,7).replace(/\b(0+)/gi,"")),e=parseInt(this.form.birthday.substring(8,10).replace(/\b(0+)/gi,""));return(1!==t&&3!==t&&5!==t&&7!==t&&8!==t&&10!==t&&12!==t||!(e>31))&&((4!==t&&6!==t&&9!==t&&11!==t||!(e>30))&&!(2===t&&e>29))},allRequired:function(t){console.log(t);var e=!0;for(var o in t){if(!this.isBirthday()||!this.isDayRight()){e=!1;break}if("age"!==o&&(null===t[o]||""==t[o])){if("sourceCity"==o&&"1"==t.country)continue;e=!1;break}}return e},newInquiry:function(t){var e=this,o=this.$common.openLoading("新建问诊中",e),i={patientId:t};this.$http.post("/inquiry/newInquiry",i).then(function(i){if(o.close(),"1"==i.code){e.$common.openSuccessMsgBox("初诊成功，请开处方",e);var s={pId:t,inquiryId:i.data.inquiryId},n=new Object;n.path="bryfpage",n.data=s,e.$store.dispatch("setPathParams",r()(n));var a=new Object;a.path="xjczbr",a.data={},a.type="new",e.$store.dispatch("setPrePathParams",r()(a)),e.$common.GotoPage("bryfpage",s,e)}else e.$common.openErrorMsgBox(i.msg,e)}).catch(function(t){console.log(t),setTimeout(function(){o.close(),e.$common.openErrorMsgBox(t,e)},1e3)})},newInquiry_new:function(t){var e=this,o={patientId:t};this.$http.post("/inquiry/newInquiry?patientId="+t,o).then(function(o){if("1"==o.code){var i={pId:t,inquiryId:o.data.inquiryId};e.getLastInquiry(i)}else e.$common.openErrorMsgBox(o.msg,e)}).catch(function(t){console.log(t),setTimeout(function(){e.$common.openErrorMsgBox(t,e)},1e3)})},getLastInquiry:function(t){var e="/inquiry/getLatestInquiryInfo?patientId="+t.pId,o=this;this.$http.get(e).then(function(e){if("1"==e.code){if("{}"!=r()(e.data)){e.data.inquiryInfo.inquiryId?t.lastinquiryId=e.data.inquiryInfo.inquiryId:t.lastinquiryId="";var i=new Object;i.path="bryfpage",i.data=t,o.$store.dispatch("setPathParams",r()(i));var s=new Object;s.path="xjczbr",s.data={},o.$store.dispatch("setPrePathParams",r()(s)),o.$common.GotoPage("bryfpage",t,o)}}else o.$common.openErrorMsgBox(e.msg,o)}).catch(function(t){setTimeout(function(){o.$common.openErrorMsgBox(t,o)},1e3)})},czSubmit:function(){var t=this,e=this.allRequired(this.form);if(console.log(this.form),this.form.age<0)this.$message({showClose:!0,message:"年龄不能小于0",type:"error"});else{if(!e)return void this.$common.openErrorMsgBox("请完整填写基本信息!",t);var o=this.$common.openLoading("初诊中",t),i=this.form;this.$http.post("/index/firstDiag",i).then(function(e){o.close(),"1"==e.code?t.newInquiry(e.data.pId):t.$common.openErrorMsgBox(e.msg,t)}).catch(function(e){setTimeout(function(){o.close(),t.$common.openErrorMsgBox(e,t)},1e3)})}},isRepeat:function(t){var e=this,o=this.$common.openLoading("复诊诊中",e),i=t;this.$http.post("/index/revisit",i).then(function(i){if(console.log("复诊",i),"1"==i.code)if(0==i.data.isRepeat)e.newInquiry_new(i.data.pId),o.close();else if(1==i.data.isRepeat){o.close();var s={pname:t.pname},n=new Object;n.path="brglpage",n.data=s,console.log(),e.$store.dispatch("setPathParams",r()(n));var a=new Object;a.path="xjczbr",a.data={},e.$store.dispatch("setPrePathParams",r()(a)),e.$common.GotoPage("brglpage",s,e)}else 2==i.data.isRepeat&&(o.close(),e.$common.openErrorMsgBox("该病人需进行初诊",e));else e.$common.openErrorMsgBox(i.msg,e)}).catch(function(t){setTimeout(function(){o.close(),e.$common.openErrorMsgBox(t,e)},1e3)})},fzSubmit:function(){this.form.pname?""!=this.form.pname.replace(/(^\s*)|(\s*$)/g,"")?this.isRepeat(this.form):this.$common.openErrorMsgBox("请填写患者姓名！",this):this.$common.openErrorMsgBox("请填写患者姓名！",this)}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"from-container-div"},[o("div",{staticClass:"base-form-c"},[o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"156px","label-position":"right"}},[o("el-form-item",{attrs:{label:"姓名",prop:"pname"}},[o("el-input",{staticClass:"index-input",attrs:{placeholder:"请输入姓名"},on:{blur:t.putinname},model:{value:t.form.pname,callback:function(e){t.$set(t.form,"pname",e)},expression:"form.pname"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"性别"}},[o("el-radio-group",{model:{value:t.form.gender,callback:function(e){t.$set(t.form,"gender",e)},expression:"form.gender"}},[o("el-radio",{attrs:{label:"男",value:"男"}}),t._v(" "),o("el-radio",{attrs:{label:"女",value:"女"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"年龄"}},[o("el-row",[o("el-col",{attrs:{span:6}},[o("el-input",{staticClass:"full-width",attrs:{placeholder:"请输入"},model:{value:t.form.age,callback:function(e){t.$set(t.form,"age",e)},expression:"form.age"}})],1),t._v(" "),o("el-col",{attrs:{span:18}},[o("label",{staticClass:"el-form-item__label",staticStyle:{width:"124px","padding-left":"20px","padding-right":"20px"}},[t._v("生日")]),t._v(" "),o("el-input",{staticClass:"index-input",staticStyle:{width:"calc(100% - 124px)"},attrs:{placeholder:"yyyy-mm-dd"},on:{blur:t.changeBirdate},model:{value:t.form.birthday,callback:function(e){t.$set(t.form,"birthday",e)},expression:"form.birthday"}})],1)],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"来源地"}},[o("el-row",{staticClass:"lyd"},[o("el-col",{attrs:{span:8}},[o("el-select",{staticStyle:{"margin-right":"10px"},on:{change:t.setProList},model:{value:t.form.country,callback:function(e){t.$set(t.form,"country",e)},expression:"form.country"}},[o("el-option",{attrs:{label:"中国",value:"0"}}),t._v(" "),o("el-option",{attrs:{label:"外国",value:"1"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-select",{staticStyle:{"margin-right":"10px","margin-left":"10px"},attrs:{filterable:"","popper-class":"city"},on:{change:t.setCityList},model:{value:t.form.sourceProvince,callback:function(e){t.$set(t.form,"sourceProvince",e)},expression:"form.sourceProvince"}},t._l(t.province,function(t){return o("el-option",{key:t.id,attrs:{label:t.provName,value:t.id}})}))],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-select",{staticStyle:{"margin-left":"10px"},attrs:{filterable:"","popper-class":"city"},model:{value:t.form.sourceCity,callback:function(e){t.$set(t.form,"sourceCity",e)},expression:"form.sourceCity"}},t._l(t.city,function(t){return o("el-option",{key:t.cityId,attrs:{label:t.cityName,value:t.cityId}})}))],1)],1)],1),t._v(" "),o("div",{staticClass:"el-form-item"},[o("div",{staticClass:"el-form-item__content",staticStyle:{height:"70px","text-align":"center","line-height":"70px"}},[o("button",{staticClass:"el-button el-button--primary normal-btn-primary",attrs:{type:"button"},on:{click:function(e){t.opencomfigMethod("请问是否进行初访?",t.czSubmit)}}},[o("span",[t._v("初诊")])]),t._v(" "),o("button",{staticClass:"el-button el-button--default normal-btn-default",attrs:{type:"button"},on:{click:function(e){t.opencomfigMethod("请问是否进行复访?",t.fzSubmit)}}},[o("span",[t._v("复诊")])])])])],1)],1)])},staticRenderFns:[]};var a=o("VU/8")(s,n,!1,function(t){o("gXKW")},null,null);e.default=a.exports},gXKW:function(t,e){}});
//# sourceMappingURL=10.5f5e15b951d675a4a679.js.map