webpackJsonp([6],{"3ilh":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o("mvHQ"),a=o.n(r),i={name:"xjczbr",data:function(){return{form:{country:"",sourceProvince:null,sourceCity:null,age:null,pname:null,birthday:null,gender:"男"},placeDate:{},country:[],province:[],city:[],rules:{pname:[{required:!0,message:"请输入姓名"}]},value1:"2018-07-01"}},created:function(){},beforeMount:function(){this.getPlace()},computed:{birthday:function(){return this.form.birthday}},watch:{birthday:function(t,e){var o=this.$common.GetAgeByBrithday(t);this.form.age=o},placeDate:function(t,e){this.setProList("0"),this.setCityList("24"),this.form.country="0",this.form.sourceProvince=24,this.form.sourceCity=1348}},methods:{setCityList:function(t){var e=this.$store.getters.gettersPlaceData.placeList;for(var o in this.form.sourceCity=null,this.city=[],e)if(e[o].id==t){this.city=e[o].cityList;break}},setProList:function(t){if(console.log(t),this.province=[],this.city=[],this.form.sourceProvince=null,this.form.sourceCity=null,"0"==t){e=(e=this.$store.getters.gettersPlaceData.placeList).slice(1,e.length-1),this.province=e}else{var e=this.$store.getters.gettersPlaceData.placeList;this.province=e[0].cityList}},updateWgzdm:function(t){var e=new Array;for(var o in t){var r=new Object;r.id=t[o].cityId,r.provName=t[o].cityName,r.cityList=[],e.push(r)}return e},getPlace:function(){var t=this.$store.getters.gettersPlaceData;if(t&&"{}"==a()(t)){var e=this;this.$http.get("/index/getPlace").then(function(o){"1"==o.code?((t=o.data).placeList[0].cityList=e.updateWgzdm(t.placeList[0].cityList),e.$store.dispatch("changePlaceData",t),e.placeDate=e.$store.getters.gettersPlaceData):e.$common.openErrorMsgBox(o.msg,e)}).catch(function(t){e.$common.openErrorMsgBox(t,e)})}},allRequired:function(t){var e=!0;for(var o in t)if(!t[o]||""==t[o]){if("sourceCity"==o&&"1"==t.country)continue;e=!1;break}return e},newInquiry:function(t){var e=this,o=this.$common.openLoading("新建问诊中",e),r={patientId:t};this.$http.post("/inquiry/newInquiry",r).then(function(r){if(o.close(),"1"==r.code){e.$common.openSuccessMsgBox("初诊成功，请开处方",e);var i={pId:t,inquiryId:r.data.inquiryId},n=new Object;n.path="bryfpage",n.data=i,e.$store.dispatch("setPathParams",a()(n));var s=new Object;s.path="xjczbr",s.data={},e.$store.dispatch("setPrePathParams",a()(s)),e.$common.GotoPage("bryfpage",i,e)}else e.$common.openErrorMsgBox(r.msg,e)}).catch(function(t){console.log(t),setTimeout(function(){o.close(),e.$common.openErrorMsgBox(t,e)},1e3)})},newInquiry_new:function(t){var e=this,o={patientId:t};this.$http.post("/inquiry/newInquiry?patientId="+t,o).then(function(o){if("1"==o.code){var r={pId:t,inquiryId:o.data.inquiryId};e.getLastInquiry(r)}else e.$common.openErrorMsgBox(o.msg,e)}).catch(function(t){console.log(t),setTimeout(function(){e.$common.openErrorMsgBox(t,e)},1e3)})},getLastInquiry:function(t){var e="/inquiry/getLatestInquiryInfo?patientId="+t.pId,o=this;this.$http.get(e).then(function(e){if("1"==e.code){if("{}"!=a()(e.data)){e.data.inquiryInfo.inquiryId?t.lastinquiryId=e.data.inquiryInfo.inquiryId:t.lastinquiryId="";var r=new Object;r.path="bryfpage",r.data=t,o.$store.dispatch("setPathParams",a()(r));var i=new Object;i.path="xjczbr",i.data={},o.$store.dispatch("setPrePathParams",a()(i)),o.$common.GotoPage("bryfpage",t,o)}}else o.$common.openErrorMsgBox(e.msg,o)}).catch(function(t){setTimeout(function(){o.$common.openErrorMsgBox(t,o)},1e3)})},czSubmit:function(){var t=this;if(this.allRequired(this.form)){var e=this.$common.openLoading("初诊中",t),o=this.form;this.$http.post("/index/firstDiag",o).then(function(o){e.close(),"1"==o.code?t.newInquiry(o.data.pId):t.$common.openErrorMsgBox(o.msg,t)}).catch(function(o){setTimeout(function(){e.close(),t.$common.openErrorMsgBox(o,t)},1e3)})}else this.$common.openErrorMsgBox("请完整填写基本信息!",t)},isRepeat:function(t){var e=this,o=this.$common.openLoading("复诊诊中",e),r=t;this.$http.post("/index/revisit",r).then(function(r){if("1"==r.code)if(0==r.data.isRepeat)e.newInquiry_new(r.data.pId),o.close();else if(1==r.data.isRepeat){o.close();var i={pname:t.pname},n=new Object;n.path="brglpage",n.data=i,e.$store.dispatch("setPathParams",a()(n));var s=new Object;s.path="xjczbr",s.data={},e.$store.dispatch("setPrePathParams",a()(s)),e.$common.GotoPage("brglpage",i,e)}else 2==r.data.isRepeat&&(o.close(),e.$common.openErrorMsgBox("该病人需进行初诊",e));else e.$common.openErrorMsgBox(r.msg,e)}).catch(function(t){setTimeout(function(){o.close(),e.$common.openErrorMsgBox(t,e)},1e3)})},fzSubmit:function(){this.form.pname?""!=this.form.pname.replace(/(^\s*)|(\s*$)/g,"")?this.isRepeat(this.form):this.$common.openErrorMsgBox("请填写患者姓名！",this):this.$common.openErrorMsgBox("请填写患者姓名！",this)}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"from-container-div"},[o("div",{staticClass:"base-form-c"},[o("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"156px","label-position":"right"}},[o("el-form-item",{attrs:{label:"姓名",prop:"pname"}},[o("el-input",{staticClass:"index-input",attrs:{placeholder:"请输入姓名"},model:{value:t.form.pname,callback:function(e){t.$set(t.form,"pname",e)},expression:"form.pname"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"性别"}},[o("el-radio-group",{model:{value:t.form.gender,callback:function(e){t.$set(t.form,"gender",e)},expression:"form.gender"}},[o("el-radio",{attrs:{label:"男",value:"男"}}),t._v(" "),o("el-radio",{attrs:{label:"女",value:"女"}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"年龄"}},[o("el-row",[o("el-col",{attrs:{span:6}},[o("el-input",{staticClass:"full-width",attrs:{placeholder:"请输入"},model:{value:t.form.age,callback:function(e){t.$set(t.form,"age",e)},expression:"form.age"}})],1),t._v(" "),o("el-col",{attrs:{span:18}},[o("label",{staticClass:"el-form-item__label",staticStyle:{width:"124px","padding-left":"20px","padding-right":"20px"}},[t._v("生日")]),t._v(" "),o("el-date-picker",{staticStyle:{width:"calc(100% - 124px)"},attrs:{type:"date",placeholder:"请选择日期",format:"yyyy/MM/dd"},model:{value:t.form.birthday,callback:function(e){t.$set(t.form,"birthday",e)},expression:"form.birthday"}})],1)],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"来源地"}},[o("el-row",{staticClass:"lyd"},[o("el-col",{attrs:{span:8}},[o("el-select",{staticStyle:{"margin-right":"10px"},on:{change:t.setProList},model:{value:t.form.country,callback:function(e){t.$set(t.form,"country",e)},expression:"form.country"}},[o("el-option",{attrs:{label:"中国",value:"0"}}),t._v(" "),o("el-option",{attrs:{label:"外国",value:"1"}})],1)],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-select",{staticStyle:{"margin-right":"10px","margin-left":"10px"},attrs:{filterable:"","popper-class":"city"},on:{change:t.setCityList},model:{value:t.form.sourceProvince,callback:function(e){t.$set(t.form,"sourceProvince",e)},expression:"form.sourceProvince"}},t._l(t.province,function(t){return o("el-option",{key:t.id,attrs:{label:t.provName,value:t.id}})}))],1),t._v(" "),o("el-col",{attrs:{span:8}},[o("el-select",{staticStyle:{"margin-left":"10px"},attrs:{filterable:"","popper-class":"city"},model:{value:t.form.sourceCity,callback:function(e){t.$set(t.form,"sourceCity",e)},expression:"form.sourceCity"}},t._l(t.city,function(t){return o("el-option",{key:t.cityId,attrs:{label:t.cityName,value:t.cityId}})}))],1)],1)],1),t._v(" "),o("div",{staticClass:"el-form-item"},[o("div",{staticClass:"el-form-item__content",staticStyle:{height:"70px","text-align":"center","line-height":"70px"}},[o("button",{staticClass:"el-button el-button--primary normal-btn-primary",attrs:{type:"button"},on:{click:t.czSubmit}},[o("span",[t._v("初诊")])]),t._v(" "),o("button",{staticClass:"el-button el-button--default normal-btn-default",attrs:{type:"button"},on:{click:t.fzSubmit}},[o("span",[t._v("复诊")])])])])],1)],1)])},staticRenderFns:[]};var s=o("VU/8")(i,n,!1,function(t){o("6p6N")},null,null);e.default=s.exports},"6p6N":function(t,e){}});
//# sourceMappingURL=6.3caa72df5e3e36474a47.js.map